<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HTML to XPath & XPath to CSS Converter</title>
    <link rel="stylesheet" href="https://rosiapng.github.io/booksource_converter/css/index_styles.css">
</head>
<body>

    <h2 class="big-title">书源语法转换器(xpath,css)</h2>
    <p class="author">By 小猫咪Rosia P'ng</p>
 <!-- Navigation Links in Button Form -->
  
    <div class="nav-box">
        <nav>
            <a class="nav-button" href="https://rosiapng.github.io/booksource_converter/index.html">书源语法转换器(xpath,css)</a>
            <a class="nav-button" href="https://rosiapng.github.io/booksource_converter/manyajs.html">傻瓜式益达转漫鸭正文JS器</a>
            <a class="nav-button" href="https://rosiapng.github.io/booksource_converter/jijian.html">傻瓜极简写源工具</a>
                        <a class="nav-button" href="https://rosiapng.github.io/booksource_converter/jjfen.html">极简源发现工具</a>
        </nav>
    </div>
    
       <h2>HTML 转Xpath器</h2>
    <div class="input-container">
        <label for="htmlInput">HTML代码:</label>
        <textarea id="htmlInput" rows="6" placeholder="&lt;div class=&quot;intro&quot;&gt;"></textarea>
        <button onclick="convertToXPath()">转换Xpath代码</button>
        <button onclick="clearInput('htmlInput')">清除</button>
    </div>

    <div class="input-container">
        <label for="xpathOutput">Xpath转换结果:</label>
        <textarea id="xpathOutput" rows="6" readonly placeholder="Xpath转换结果"></textarea>
        <button onclick="copyOutput('xpathOutput')">复制</button>
    </div>
    
      <h2>Xpath 转CSS器（漫鸭版本）</h2>
      
       <p>使用方法: 输入 XPath 代码（例如 <code>//div[@class="intro"]</code>），将会转换成 <code>div[class="intro"]</code></p>
    <!-- XPath to CSS Converter -->
    <div class="input-container">
        <label for="xpathInput">Xpath代码:</label>
        <textarea id="xpathInput" rows="6" placeholder="输入Xpath代码"></textarea>
        <button onclick="convertToCSS()">转换CSS代码</button>
        <button onclick="clearInput('xpathInput')">清除</button>
    </div>
    

    
    <div class="input-container">
        <label for="cssOutput">CSS转换结果:</label>
        <textarea id="cssOutput" rows="6" readonly placeholder="CSS转换结果"></textarea>
        <button onclick="copyOutput('cssOutput')">复制</button>
    </div>
    
            // Function to convert HTML element to XPath
        function getXPathForElement(element) {
            if (!element || element.nodeType !== 1) return ''; // Ensure the element is an element node

            let xpath = '//' + element.tagName.toLowerCase(); // Start with the tag name

            // Special handling for <meta> elements
            if (element.tagName.toLowerCase() === 'meta') {
                const property = element.getAttribute('property');
                const name = element.getAttribute('name');

                if (property) {
                    xpath += `[@property="${property}"]`; // Handle property attributes
                } else if (name) {
                    xpath += `[@name="${name}"]`; // Handle name attributes
                }
                return xpath; // Return immediately for meta tags
            }

            // Handle attributes for other elements
            const attributes = element.attributes;
            if (attributes.length > 0) {
                let conditions = [];
                for (let i = 0; i < attributes.length; i++) {
                    let attr = attributes[i];
                    // Exclude 'id' and 'class' if needed, but keep all other attributes
                    if (attr.name !== "id" && attr.name !== "class") {
                        conditions.push(`@${attr.name}="${attr.value}"`);
                    }
                }

                // Combine all attribute conditions
                if (conditions.length > 0) {
                    xpath += '[' + conditions.join(' and ') + ']'; // Combine attributes into one predicate
                }
            }

            // Check for id and class attributes last to add them if they exist
            if (element.id) {
                xpath += `[@id="${element.id}"]`;
            } 
            if (element.className) {
                xpath += `[@class="${element.className}"]`;
            }

            return xpath; // Return the constructed XPath
        }

        // Function to convert the HTML input to XPath
        function convertToXPath() {
            const htmlCode = document.getElementById('htmlInput').value;
            const parser = new DOMParser();
            const doc = parser.parseFromString(htmlCode, 'text/html');

            // Select all elements within the document including <head> section
            const elements = doc.querySelectorAll('head meta, body *'); // Select meta from head and all from body

            // Prepare an array to hold the XPaths
            let xpaths = [];
            elements.forEach(element => {
                const xpath = getXPathForElement(element);
                if (xpath) xpaths.push(xpath); // Only add non-empty XPath
            });

            // Join the XPath results with a line break
            document.getElementById('xpathOutput').value = xpaths.join('\n');
        }


</body>
</html>
