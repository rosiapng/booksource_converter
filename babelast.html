<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JS Deobfuscator</title>

    <!-- Load Babel Standalone -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Load Babel Modules -->
    <script>
        async function loadBabelModules() {
            const babelParserModule = await import("https://cdn.jsdelivr.net/npm/@babel/parser@7.21.4/+esm");
            const babelTraverseModule = await import("https://cdn.jsdelivr.net/npm/@babel/traverse@7.21.4/+esm");
            const babelGeneratorModule = await import("https://cdn.jsdelivr.net/npm/@babel/generator@7.21.4/+esm");

            // ✅ Fix: Correctly assign named exports
            window.babelParser = babelParserModule;
            window.babelTraverse = babelTraverseModule.traverse;
            window.babelGenerator = babelGeneratorModule;
        }
        loadBabelModules();
    </script>
</head>
<body>
    <h2>JavaScript Deobfuscator</h2>
    <textarea id="inputCode" rows="10" cols="50" placeholder="Paste obfuscated JavaScript here"></textarea>
    <br>
    <button id="deobfuscateButton">Deobfuscate</button>
    <h3>Deobfuscated Code:</h3>
    <pre id="outputCode"></pre>

    <script>
        async function deobfuscate() {
            try {
                if (!window.babelParser || !window.babelTraverse || !window.babelGenerator) {
                    document.getElementById("outputCode").textContent = "Error: Babel modules not loaded yet!";
                    return;
                }

                const inputCode = document.getElementById("inputCode").value;
                if (!inputCode.trim()) {
                    document.getElementById("outputCode").textContent = "Error: No input code provided!";
                    return;
                }

                // ✅ Fix: Ensure proper source type for parsing
                const ast = window.babelParser.parse(inputCode, {
                    sourceType: "script",
                    allowReturnOutsideFunction: true,
                    plugins: ["jsx"]
                });

                // ✅ Fix: Use `window.babelTraverse(ast, callback)`
                window.babelTraverse(ast, {
                    VariableDeclarator(path) {
                        const binding = path.scope.getBinding(path.node.id.name);
                        if (binding && binding.references === 0) {
                            path.remove();
                        }
                    },
                    IfStatement(path) {
                        if (path.node.test.type === "BooleanLiteral" && !path.node.test.value) {
                            path.remove();
                        }
                    },
                    ExpressionStatement(path) {
                        if (path.node.expression.type === "NumericLiteral" || path.node.expression.type === "StringLiteral") {
                            path.remove();
                        }
                    },
                    ReturnStatement(path) {
                        let next = path.getSibling(path.key + 1);
                        while (next.node) {
                            next.remove();
                            next = path.getSibling(next.key + 1);
                        }
                    }
                });

                // ✅ Fix: Use correct generator
                const output = window.babelGenerator.default(ast, {
                    retainLines: true
                }).code;

                document.getElementById("outputCode").textContent = output || "No changes detected.";
            } catch (err) {
                document.getElementById("outputCode").textContent = "Error: " + err.message;
            }
        }

        document.getElementById("deobfuscateButton").addEventListener("click", deobfuscate);
    </script>
</body>
</html>
