<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HTML to JSON Converter</title>
<link rel="stylesheet" href="https://rosiapng.github.io/booksource_converter/css/index_styles.css">
</head>
<body>
<!-- Navigation Links in Button Form -->
    <h2 class="big-title">极简源发现转换工具</h2>
    <p class="author">By 小猫咪Rosia P'ng</p>
    
    <div class="nav-box">
        <nav>
            <a class="nav-button" href="https://rosiapng.github.io/booksource_converter/index.html">书源语法转换器(xpath,css)</a>
            <a class="nav-button" href="https://rosiapng.github.io/booksource_converter/manyajs.html">傻瓜式益达转漫鸭正文JS器</a>
            <a class="nav-button" href="https://rosiapng.github.io/booksource_converter/jijian.html">傻瓜极简写源工具</a>
                        <a class="nav-button" href="https://rosiapng.github.io/booksource_converter/jjfen.html">极简源发现工具</a>
        </nav>
    </div>
    
<h1>极简源发现转换工具<h1>
<p>Paste the HTML list below and click "Convert to JSON" to get the JSON format.</p>

<h1>HTML to JSON Converter</h1>
<p>Paste your HTML list below and click "Convert to JSON" to get the JSON output in the same box.</p>

<!-- Input/Output Box for HTML List and JSON -->
<div class="input-container">
    <label for="htmlInput">HTML Input / JSON Output:</label>
    <textarea id="htmlInput" rows="10" placeholder='<li><a href="/all/" title="书库,书库大全">书库大全</a></li>'></textarea>
    <div class="button-container">
        <button onclick="convertHtmlToJson()">Convert to JSON</button>
        <button onclick="clearInput('htmlInput')">Clear</button>
        <button onclick="pasteText('htmlInput')">Paste</button>
    </div>
</div>

<h2>Regex Tool</h2>
<!-- Input box for regex pattern -->
<div class="input-container">
    <label for="regexPattern">Regex Pattern:</label>
    <input type="text" id="regexPattern" placeholder="Enter regex pattern (e.g., \\d+ for digits)">
</div>

<!-- Input box to display regex matches -->
<div class="input-container">
    <label for="regexMatches">Regex Matches:</label>
    <textarea id="regexMatches" rows="4" readonly placeholder="Matches will appear here"></textarea>
</div>

<!-- Input box for replacement string -->
<div class="input-container">
    <label for="regexReplacement">Replacement String (leave empty to clear matches):</label>
    <input type="text" id="regexReplacement" placeholder="Enter replacement string">
</div>

<div class="button-container">
    <button onclick="applyRegex()">Apply Regex</button>
</div>

<script>
    // Function to convert HTML list to JSON
    function convertHtmlToJson() {
        const input = document.getElementById('htmlInput').value;
        const parser = new DOMParser();
        const doc = parser.parseFromString(input, 'text/html');
        const listItems = doc.querySelectorAll('li a');
        const jsonArray = [];

        listItems.forEach(item => {
            const name = item.textContent.trim();  // Extract visible text (name)
            const value = item.getAttribute('href'); // Extract href attribute and rename it to 'value'

            jsonArray.push({ name,value });
        });

        // Replace input with the converted JSON
        document.getElementById('htmlInput').value = JSON.stringify(jsonArray, null, 4);
    }

    // Function to clear the input/output field
    function clearInput(inputId) {
        document.getElementById(inputId).value = '';
    }

    // Function to paste text from clipboard
    function pasteText(inputId) {
        navigator.clipboard.readText().then(
            text => {
                document.getElementById(inputId).value = text;
            }
        ).catch(
            err => {
                console.error('Failed to read clipboard contents: ', err);
            }
        );
    }

    // Function to apply regex
    function applyRegex() {
        const inputText = document.getElementById('htmlInput').value;
        const regexPattern = document.getElementById('regexPattern').value;
        const replacement = document.getElementById('regexReplacement').value;

        try {
            const regex = new RegExp(regexPattern, 'g'); // Create regex with global flag
            const matches = inputText.match(regex); // Find all matches

            // Display matches in the regexMatches box
            document.getElementById('regexMatches').value = matches ? matches.join('\n') : 'No matches found';

            // Replace matches if replacement string is provided, otherwise remove matches
            const updatedText = inputText.replace(regex, replacement);

            // Display the result in the same input/output box
            document.getElementById('htmlInput').value = updatedText;
        } catch (error) {
            document.getElementById('regexMatches').value = 'Invalid regex pattern';
        }
    }
</script>

</body>
</html>