<script>function $(selector) { return document.querySelector(selector); }
function $$(selector) { return document.querySelectorAll(selector); }</script>

<style>

button,input{
margin:5px
}
#basic-addon1,#replaceSpan1{
background-color:Azure;
padding:3px
}
button,input[type="button"]{
	outline:none;
	height:30px;
	box-shadow:2px 1px #CFD8DC;
	background:#fff;
	border:1px solid #607D8B;
	border-radius:6px;
	}
textarea{
background-color:GhostWhite;
border:0px solid black
}
.bt1,.bt4{
	background:#fff;
	width:30%;
	border:1px solid green;
	border-radius:10px;
	}
#bt4:active,#bt2:active{
	background:#CFD8DC
	}
	#bt4,#bt2{
		background:#fff;
	width:100%;
	border:1px solid #607D8B;
	border-radius:6px;
		}
		button:active,input[type="button"]:active{
	background:#C8E6C9
	}
	#success{
		text-align:center;
		border:1px solid green;
		position:fixed;
		left:40%;
		width:20%;
		background:#fff;
		border-radius:5px;
		display:none;
		top:2px;
		box-shadow:2px 1px 3px #CFD8DC;
		}
		#pageclass,#pageclass2{
			width:100%
			}
			.pageclass{
				font-size:10px
				}
#jhss a{
font-size:10px;
color:red;
text-decoration:none;
}

#jhss p{
display:inline-block;
width:8em;
}

#jhss p{
margin:0;
padding:0;
color:#666;
}

#jhss div{
margin:0;
padding:10px;
}

#jhss h1{
margin:0;
padding:9px;
font-size:20px;
}

#jhss input{
margin:2px;
padding:2px 6px;
font-size: 1em;
background-color:rgba(200,200,200,0.5);
color:#A00;
border:0;
border-radius: 3px;
text-decoration: none;
text-align:center;
}
textarea{
width:100%
}
.menu {
	justify-content: space-between;
	max-width: 900px;
	margin: 0 5px;
}
.menu .button {
	width: 55px;
	height: 15px;
	min-height: 5px;
	margin: 5px 0px;
	cursor: pointer;
}
.button text {
	text-anchor: middle;
	dominant-baseline: middle;
}

.button rect {
	width: 100%;
	height: 100%;
	fill: transparent;
	stroke: #666;
	stroke-width: 2px;
}
.button rect.busy {
	stroke: #fD1850;
	stroke-dasharray: 30 90;
	animation: stroker 1s linear infinite;
}
.tabbox {
	flex: 1;
	display: flex;
	flex-flow: column;
}
.tabtitle {
	display: flex;
	z-index: 1;
	justify-content: center;
}
.tabtitle>div {
	cursor: pointer;
	padding: 1px 10px 0 10px;
	border-bottom: 3px solid transparent;
	font-weight: bold;
}
.tabtitle>.this {
	color: #4f9da6;
	border-bottom-color: #4EBBE4;
}
.tabbody {
	flex: 1;
	display: flex;
	margin-top: -1px;
	border: 1px solid #A9A9A9;
	height: 0;
}
.tabbody>* {
	flex: 1;
	flex-flow: column;
	display: none;
}
.tabbody>.this {
	display: flex;
}
.tabbody>*>.titlebar{
	display: flex;
}
.tabbody>*>.titlebar>*{
	flex: 1;
	margin: 1px 1px 1px 1px;
}
.tabbody>*>.context {
	flex: 1;
	flex-flow: column;
	border: 0;
	padding: 5px;
	overflow-y: auto;
}
.tabbody>*>.inputbox{
	border: 0;
	border-bottom: #A9A9A9 solid 1px;
	height: 15px;
	text-align:center;
}
.link>* {
	display: flex;
	margin: 5px;
	border-bottom: 1px solid;
	text-decoration: none;
}
#RuleList>label>* {
	background: #eee;
	padding-left: 3px;
	margin: 2px 0;
	cursor: pointer;
}
#RuleList input[type=radio] {
	display: none;
}
#RuleList input[type="radio"]:checked+* {
	background: #15cda8;
}
.isError {
	color: #FF0000;
}
#RuleJsonString{
height:600px
}
svg text{
font-size:10px
}
</style>
 
<a href="https://www.sojson.com/rehtml">html转义</a>&nbsp;&nbsp;<a href="http://www.jsons.cn/urlencode/">URL解码</a>
<textarea rows="10" id="input" onfocus="di()" placeholder="输入带html标签的发现内容"></textarea>
<button onclick="getInput();dis()" class="bt1">格式化发现[旧]</button>
<button onclick="getInput2();dis()" class="bt1">格式化发现[新]</button>
<button onclick="getInput3();" class="bt1">发现格式互转</button>

<button onclick="getInput4(1);" id="bt4">（新发现）改样式先点这个</button>
<button onclick="getInput4(2,1);" class="bt4">一排一个</button>
<button onclick="getInput4(2,2);" class="bt4">一排两个</button>
<button onclick="getInput4(2,3);" class="bt4">一排三个</button>
<button onclick="getInput4(2,4);" class="bt4">一排四个</button>

<button onclick="copyText()" id="bt2">一键复制</button>

<div class="pageclass">输入分类里的链接，如：
/sort/xuanhuan/
写成
/sort/分类/
</div>
<input id="pageclass">
<div class="pageclass">输入带有翻页的链接，如：
/sort/xuanhuan/2.html
写成
/sort/分类/页码.html
</div>
<input id="pageclass2">

<div class="pageclass">
第一页跟第二页不一样？
输入不一样的部分（第二页比第一页多出来的部分）
如
index_页码.html
</div>
<input id="pageclass3">


<button onclick="okpage()">确认加入翻页（仅旧发现）</button>


<p id="success">复制成功！</p><br><br><br>
<p>正则表达式匹配替换</p>
 <div class="form-group">
                    <div class="col-sm-12">
                        <textarea class="form-control" onmouseover="this.focus();" id="textSour" name="textSour" rows="10" style="max-height: 2222px;" placeholder="请输入要验证的文本"></textarea>
                    </div>
                </div>
                <div class="form-group">
                    <div class="col-sm-12">
                        <div class="input-group">
                            <span class="input-group-addon" id="basic-addon1">正则表达式</span>
                            <input type="text" class="form-control" id="textPattern" name="textPattern" placeholder="请输入自定义正则表达式 例如：\d{6}" aria-describedby="basic-addon1" style="width: 65%;">
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <div class="col-sm-2">
                        <div class="input-group" style="margin-left: 20px;">
                            <label class="checkbox" style="cursor: pointer;">
                                <input type="checkbox" value="global" checked="checked" id="optionGlobal" name="optionGlobl">全局搜索</label>
                        </div>
                    </div>
                    <div class="col-sm-2">
                        <div class="input-group" style="margin-left: 20px;">
                            <label class="checkbox" style="cursor: pointer;">
                                <input type="checkbox" value="ignoreCase" id="optionIgnoreCase" name="optionIgnoreCase">忽略大小写</label>
                        </div>
                    </div>
                    <div class="col-sm-8">
                        <input type="button" onclick="return onMatch();" value="验证匹配内容" class="btn btn-success">
                        <input type="button" onclick="Empty();" value="清空输入框" class="btn btn-danger">
<button onclick="copyText3()">一键复制</button>
                    </div>
                </div>
                <div class="form-group">
                    <div class="col-sm-12">
<div id="textResult"></div>
                        <textarea onmouseover="this.focus();" id="textMatchResult" class="form-control" rows="10" style="max-height: 2222px;" placeholder="得到验证后内容，内容为空为验证失败" readonly="readonly"></textarea>
                    </div>
                </div>
                <div class="form-group">
                    <div class="col-sm-4">
                        <div class="input-group" style="width: 98%;">
                            <span class="input-group-addon" id="replaceSpan1">替换文本</span>
                            <input type="text" class="form-control" id="textReplace" name="textReplace" placeholder="请输入替换内容" aria-describedby="replaceSpan1" style="width: 70%;">
<button value="{\{page}}" onclick="pp(this.value)">page</button>

<button value="$" onclick="pp(this.value)">$</button>

<button value="'" onclick="pp(this.value)">'</button>
<button value="/" onclick="pp(this.value)">/</button>
<button value="_" onclick="pp(this.value)">_</button>
<button value="-" onclick="pp(this.value)">-</button>
                        </div>
                    </div>
                    <div class="col-sm-2">
                        <div class="input-group">
                            <button onclick="return onReplace()" class="btn btn-success">替换匹配内容</button>
<button onclick="copyText2()">一键复制</button>
                        </div>
                    </div>
                    <div class="col-sm-6">
                    </div>
                </div>
                <div class="form-group">
                    <div class="col-sm-12">
                        <textarea readonly="readonly" id="textReplaceResult" class="form-control" rows="10" placeholder="此处为替换后内容"></textarea>
                    </div>
                </div>
                </form>
            </div>
        </div>
<script>
 var copyText = function() {
	var text = document.getElementById('input');
    // 选中文本
    text.select()
    // 复制
    document.execCommand('copy')
    text.blur()
    $("#success").style.display = "block";
    setTimeout(function(){
                $("#success").style.display = "none";
          },500)
}

var copyText2 = function() {
    var text = document.getElementById('textReplaceResult');
    // 选中文本
    text.select()
    // 复制
    document.execCommand('copy')
    text.blur()
    $("#success").style.display = "block";
    setTimeout(function(){
                $("#success").style.display = "none";
          },500)
}

var copyText3 = function() {
    var text = document.getElementById('textMatchResult');
    // 选中文本
    text.select()
    // 复制
    document.execCommand('copy')
    text.blur()
    $("#success").style.display = "block";
    setTimeout(function(){
                $("#success").style.display = "none";
          },500)
}

</script>


<script>
function pp(a){
	b=a.replace(/\\/,'');
$("#textReplace").value+=b;
$("#textReplace").focus()
}
function dis(){
document.getElementById("bt1").disabled=true;
document.getElementById("bt2").disabled=true
}
function di(){
document.getElementById("bt1").disabled=false;
document.getElementById("bt2").disabled=false
}

function parseToDOM(str){
   var div = document.createElement("div");
   if(typeof str == "string")
       div.innerHTML = str;
   return div.querySelectorAll("a"); ;
}


function okpage(){
	pageclass = $("#pageclass").value.replace(/(\+|\?)/g,'\\$1');

	pageclass=pageclass.replace(/分类$/g,'(.*)').replace(/分类(?!$)/g,'(.*?)');
	
	reg = new RegExp(pageclass)
	pageclass2 = $("#pageclass2").value;
	html = $("#input").value;
	pageclass2=pageclass2.replace(/页码/g,'{\{page}}');
	
	pageclass3 =$("#pageclass3").value.replace(/(\+|\?)/g,'\\$1').replace(/页码/,'{\{page}}')

	h = "";
	if(html.match(/::/) && pageclass!="" && pageclass2!="" && !/{\{page}}/.test(html)){
		list = html.split(/\n|&&/);
	  for(i in list){
	  	if(list[i].match(/::/)){
	       	text = list[i].match(/(.*?)::/)[1];
	       	href=list[i].match(/::(.*)/)[1]
	       	if(href.match(reg)){
	  	        	href = pageclass2.replace(/分类/g,href.match(reg)[1])
	  		   }else{href=href}	
	      		h+=text+"::"+href+"\n"
	  	 }
	  	}
	  	$("#input").value = h
		}
		
		html = $("#input").value
		if(pageclass3!="" && !/<,.*?>/.test(html)){
			 reg=new RegExp("("+pageclass3+")",'g');
		  $("#input").value =	html.replace(reg,'<,$1>')
			
			}
		
		
	}



function getInput(){
var str=$("#input").value;
var list = parseToDOM(str);
if(list.length==0){
	$("#input").placeholder = "格式化失败！！！请检查是否为带html标签的文本"
	}else{
		
var html = "";
for (let i=0;i<list.length;i++){
	let text = list[i].innerText;
	let href = list[i].getAttribute("href");
	html += text + "::" + href +"\n"
	}
$("#input").value = html
}
}

function getInput2(){
var str=$("#input").value;
var list = parseToDOM(str);
if(list.length==0){
	$("#input").placeholder = "格式化失败！！！请检查是否为带html标签的文本"
	}else{
var html = [];
for (let i=0;i<list.length;i++){
	let text = list[i].innerText;
	let href = list[i].getAttribute("href");
	html.push({
		title:text,
		url : href
		})
	}
$("#input").value = JSON.stringify(html)
}
}

function getInput3(){
text=$("#input").value;
if(text.match(/\&\&|::/g)){
text=text.replace(/\&\&/g,'\n');
list=text.match(/.*::.*/g);
html=[];
for(i=0;i<list.length;i++){
l=list[i].match(/(.*)::(.*)/);
title=l[1];url=l[2]
html.push({
title:title,
url:url
})
}
$("#input").value=JSON.stringify(html)
}else{
html="";
json=eval(text);
for(i in json){
html+=json[i].title+"::"+json[i].url+"\n"
}
$("#input").value=html
}
}


function getInput4(flag,x){
text=$("#input").value;
if(flag==1){
json=JSON.parse(text);
for(i in json){
json[i].style={}
json[i].style.layout_flexGrow=1
}
}else if(flag==2){
	data={1:1,2:0.4,3:0.25,4:0.2}
json=JSON.parse(text);
for(i in json){
json[i].style.layout_flexBasisPercent=data[x]
}
}
$("#input").value=JSON.stringify(json)
}




function setVisible(idElement, visible) {
    var obj = document.getElementById(idElement);
    obj.style.visibility = visible ? "visible" : "hidden";
}
function isValidFields() {
    var textSour = document.getElementById("textSour");
    if (null == textSour.value || textSour.value.length < 1) {
        textSour.focus();
        JsonsMessageBox($("#textSour"), "请输入待匹配文本");
        return false;
    }
    var textPattern = document.getElementById("textPattern");
    if (null == textPattern.value || textPattern.value.length < 1) {
        textPattern.focus();
        JsonsMessageBox($("#textPattern"), "请输入正则表达式");
        return false;
    }
    return true;
}
function buildRegex() {
    var op = "";
    if (document.getElementById("optionGlobal").checked) op = "g";
    if (document.getElementById("optionIgnoreCase").checked) op = op + "i";
    return new RegExp(document.getElementById("textPattern").value, op);
}
function onMatch() {
    if (!isValidFields())
        return false;
    document.getElementById("textMatchResult").value = "";
    var regex = buildRegex();
    var result = document.getElementById("textSour").value.match(regex);
    if (null == result || 0 == result.length) {
        document.getElementById("textMatchResult").value = "（没有匹配）";
        return false;
    }
    if (document.getElementById("optionGlobal").checked) {
var re="";
        var strResult = "共找到 " + result.length + " 处匹配：\r\n";
document.getElementById("textResult").innerText=strResult;
for (var i = 0; i < result.length; ++i){ re += result[i] + "\r\n";}
        document.getElementById("textMatchResult").value = re;
    }
    else {
   document.getElementById("textMatchResult").value = "匹配位置：" + regex.lastIndex + "\r\n匹配结果："+result[0];
    }
    return true;
}
function onReplace() {
    var str = document.getElementById("textSour").value;
    var regex = buildRegex();
    document.getElementById("textReplaceResult").value = str.replace(regex, document.getElementById("textReplace").value);
}
function reset() {
     $("#textSour").value="";
    $("#textPattern").value="";
    $("#textMatchResult").value="";
    $("#textReplace").value="";
    $("#textReplaceResult").value="";
}
$("#regCommon a").click(function () {
    $("#textPattern").val($(this).attr("t"));
    onMatch();
});
function Empty() {
    $("#textSour").value="";
    $("#textMatchResult").value="";
    $("#textReplace").value="";
    $("#textReplaceResult").value="";
    $("#textSour").select();
}
</script>
