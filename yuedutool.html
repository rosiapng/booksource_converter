<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>开源阅读/源阅发现转换工具</title>

    <style>
        textarea {
     width: 100% !important;
    height: 200px !important;
    font-size: 16px;
    padding: 10px;
    box-sizing: border-box;
    margin-bottom: 10px;
}
    </style>
    <link rel="stylesheet" href="./css/index_styles.css">
</head>
<body>
    <!-- Navigation Links in Button Form -->
    <h2 class="big-title">开源阅读/源阅发现转换工具</h2>
    <p class="author">By 小猫咪Rosia P'ng</p>
    
    <div class="nav-box">
    <nav>
        <a class="nav-button" href="./index.html">书源语法转换器(xpath,css)</a>
        <a class="nav-button" href="./manyajs.html">傻瓜式益达转漫鸭正文JS器</a>
        <a class="nav-button" href="./jijian.html">傻瓜极简写源工具</a>
        <a class="nav-button" href="./jjfen.html">极简源发现工具</a>
        <a class="nav-button" href="./yuedu.html">阅读源发现格式转换极简源发现</a>
        <a class="nav-button" href="./beuti.html">美化Json和JS</a>
        <a class="nav-button" href="./code.html">Js测试</a>
        <a class="nav-button" href="./base64.html">Base64和URI decode</a>
        <a class="nav-button" href="./aes.html">Crypto AES解密测试</a>
        <a class="nav-button" href="./yuedutool.html">开源阅读/源阅发现转换工具</a>
        <a class="nav-button" href="./qingnao.html">极简微光转换器</a>
    </nav>
</div>

  <h1 class="title">开源阅读/源阅发现转换工具</h1>

<script>function $(selector) { return document.querySelector(selector); }
function $$(selector) { return document.querySelectorAll(selector); }</script>



<textarea id="input" class="form-control" onfocus="di()" placeholder="输入带html标签的发现内容"></textarea>
<button onclick="getInput();dis()" class="bt1">格式化发现[旧]</button>
<button onclick="getInput2();dis()" class="bt1">格式化发现[新](Json格式)</button>
<button onclick="getInput3();" class="bt1">发现格式互转</button>

<button onclick="getInput4(1);" id="bt4">美化发现必须点这个（必须是Json格式）</button>
<button onclick="getInput4(2,1);" class="bt4">一排一个</button>
<button onclick="getInput4(2,2);" class="bt4">一排两个</button>
<button onclick="getInput4(2,3);" class="bt4">一排三个</button>
<button onclick="getInput4(2,4);" class="bt4">一排四个</button>

<button onclick="copyText()" id="bt2">一键复制</button>
<button onclick="pasteText()" id="bt5">粘贴</button>


<p>正则表达式匹配替换</p>

<div class="form-group">
    <div class="col-sm-12">
       <textarea class="form-control" id="textSour" name="textSour" rows="10" placeholder="请输入要验证的文本"></textarea>
        <div> <!-- Added div to make button appear below -->
            <button onclick="pasteText2()" class="bt4">粘贴</button>
        </div>
    </div>
</div>

                <div class="form-group">
                    <div class="col-sm-12">
                        <div class="input-group">
                            <span class="input-group-addon" id="basic-addon1">正则表达式</span>
                            <input type="text" class="form-control" id="textPattern" name="textPattern" placeholder="请输入自定义正则表达式 例如：\d{6}" aria-describedby="basic-addon1" style="width: 65%;">
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <div class="col-sm-2">
                        <div class="input-group" style="margin-left: 20px;">
                            <label class="checkbox" style="cursor: pointer;">
                                <input type="checkbox" value="global" checked="checked" id="optionGlobal" name="optionGlobl">全局搜索</label>
                        </div>
                    </div>
                    <div class="col-sm-2">
                        <div class="input-group" style="margin-left: 20px;">
                            <label class="checkbox" style="cursor: pointer;">
                                <input type="checkbox" value="ignoreCase" id="optionIgnoreCase" name="optionIgnoreCase">忽略大小写</label>
                        </div>
                    </div>
                    
                    <div class="col-sm-8">
                       <button onclick="onMatch();" class="btn btn-success">验证匹配内容</button>
<button onclick="Empty();" class="btn btn-danger">清空输入框</button>
<button onclick="copyText3()">一键复制</button>
                    </div>
                </div>
                <div class="form-group">
                    <div class="col-sm-12">
<div id="textResult"></div>
                        <textarea class="form-control" id="textMatchResult" placeholder="得到验证后内容，内容为空为验证失败" readonly></textarea>
                    </div>
                </div>
                <div class="form-group">
                    <div class="col-sm-4">
                        <div class="input-group" style="width: 98%;">
                            <span class="input-group-addon" id="replaceSpan1">替换文本</span>
                            <input type="text" class="form-control" id="textReplace" name="textReplace" placeholder="请输入替换内容" aria-describedby="replaceSpan1" style="width: 70%;">
<button value="{\{page}}" onclick="pp(this.value)">page</button>

<button value="$" onclick="pp(this.value)">$</button>

<button value="'" onclick="pp(this.value)">'</button>
<button value="/" onclick="pp(this.value)">/</button>
<button value="_" onclick="pp(this.value)">_</button>
<button value="-" onclick="pp(this.value)">-</button>
<button value=".html" onclick="pp(this.value)">.html</button>
                        </div>
                    </div>
																				
                    <div class="col-sm-2">
                        <div class="input-group">
                            <button onclick="return onReplace()" class="btn btn-success">替换匹配内容</button>
<button onclick="copyText2()">一键复制</button>
                        </div>
                    </div>
                    <div class="col-sm-6">
                    </div>
                </div>
                <div class="form-group">
                    <div class="col-sm-12">
                        <textarea class="form-control" id="textReplaceResult" placeholder="此处为替换后内容" readonly></textarea>
                    </div>
                </div>
                </form>
            </div>
        </div>
<script>
 var copyText = function() {
	var text = document.getElementById('input');
    // 选中文本
    text.select()
    // 复制
    document.execCommand('copy')
    text.blur()
    $("#success").style.display = "block";
    setTimeout(function(){
                $("#success").style.display = "none";
          },500)
}

var copyText2 = function() {
    var text = document.getElementById('textReplaceResult');
    // 选中文本
    text.select()
    // 复制
    document.execCommand('copy')
    text.blur()
    $("#success").style.display = "block";
    setTimeout(function(){
                $("#success").style.display = "none";
          },500)
}

var copyText3 = function() {
    var text = document.getElementById('textMatchResult');
    // 选中文本
    text.select()
    // 复制
    document.execCommand('copy')
    text.blur()
    $("#success").style.display = "block";
    setTimeout(function(){
                $("#success").style.display = "none";
          },500)
}

var pasteText = function() {
    navigator.clipboard.readText().then(text => {
        document.getElementById('input').value = text;
    });
}

var pasteText2 = function() {
    navigator.clipboard.readText().then(text => {
        document.getElementById('textSour').value = text;
    });
}

var pasteText3 = function() {
    navigator.clipboard.readText().then(text => {
        document.getElementById('textMatchResult').value = text;
    });
}

</script>


<script>
function pp(a){
	b=a.replace(/\\/,'');
$("#textReplace").value+=b;
$("#textReplace").focus()
}
function dis(){
document.getElementById("bt1").disabled=true;
document.getElementById("bt2").disabled=true
}
function di(){
document.getElementById("bt1").disabled=false;
document.getElementById("bt2").disabled=false
}

function parseToDOM(str){
   var div = document.createElement("div");
   if(typeof str == "string")
       div.innerHTML = str;
   return div.querySelectorAll("a"); ;
}


function okpage(){
	pageclass = $("#pageclass").value.replace(/(\+|\?)/g,'\\$1');

	pageclass=pageclass.replace(/分类$/g,'(.*)').replace(/分类(?!$)/g,'(.*?)');
	
	reg = new RegExp(pageclass)
	pageclass2 = $("#pageclass2").value;
	html = $("#input").value;
	pageclass2=pageclass2.replace(/页码/g,'{\{page}}');
	
	pageclass3 =$("#pageclass3").value.replace(/(\+|\?)/g,'\\$1').replace(/页码/,'{\{page}}')

	h = "";
	if(html.match(/::/) && pageclass!="" && pageclass2!="" && !/{\{page}}/.test(html)){
		list = html.split(/\n|&&/);
	  for(i in list){
	  	if(list[i].match(/::/)){
	       	text = list[i].match(/(.*?)::/)[1];
	       	href=list[i].match(/::(.*)/)[1]
	       	if(href.match(reg)){
	  	        	href = pageclass2.replace(/分类/g,href.match(reg)[1])
	  		   }else{href=href}	
	      		h+=text+"::"+href+"\n"
	  	 }
	  	}
	  	$("#input").value = h
		}
		
		html = $("#input").value
		if(pageclass3!="" && !/<,.*?>/.test(html)){
			 reg=new RegExp("("+pageclass3+")",'g');
		  $("#input").value =	html.replace(reg,'<,$1>')
			
			}
		
		
	}



function getInput(){
var str=$("#input").value;
var list = parseToDOM(str);
if(list.length==0){
	$("#input").placeholder = "格式化失败！！！请检查是否为带html标签的文本"
	}else{
		
var html = "";
for (let i=0;i<list.length;i++){
	let text = list[i].innerText;
	let href = list[i].getAttribute("href");
	html += text + "::" + href +"\n"
	}
$("#input").value = html
}
}

function getInput2(){
var str=$("#input").value;
var list = parseToDOM(str);
if(list.length==0){
	$("#input").placeholder = "格式化失败！！！请检查是否为带html标签的文本"
	}else{
var html = [];
for (let i=0;i<list.length;i++){
	let text = list[i].innerText;
	let href = list[i].getAttribute("href");
	html.push({
		title:text,
		url : href
		})
	}
$("#input").value = JSON.stringify(html)
}
}

function getInput3(){
text=$("#input").value;
if(text.match(/\&\&|::/g)){
text=text.replace(/\&\&/g,'\n');
list=text.match(/.*::.*/g);
html=[];
for(i=0;i<list.length;i++){
l=list[i].match(/(.*)::(.*)/);
title=l[1];url=l[2]
html.push({
title:title,
url:url
})
}
$("#input").value=JSON.stringify(html)
}else{
html="";
json=eval(text);
for(i in json){
html+=json[i].title+"::"+json[i].url+"\n"
}
$("#input").value=html
}
}


function getInput4(flag,x){
text=$("#input").value;
if(flag==1){
json=JSON.parse(text);
for(i in json){
json[i].style={}
json[i].style.layout_flexGrow=1
}
}else if(flag==2){
	data={1:1,2:0.4,3:0.25,4:0.2}
json=JSON.parse(text);
for(i in json){
json[i].style.layout_flexBasisPercent=data[x]
}
}
$("#input").value=JSON.stringify(json)
}




function setVisible(idElement, visible) {
    var obj = document.getElementById(idElement);
    obj.style.visibility = visible ? "visible" : "hidden";
}
function isValidFields() {
    var textSour = document.getElementById("textSour");
    if (null == textSour.value || textSour.value.length < 1) {
        textSour.focus();
        JsonsMessageBox($("#textSour"), "请输入待匹配文本");
        return false;
    }
    var textPattern = document.getElementById("textPattern");
    if (null == textPattern.value || textPattern.value.length < 1) {
        textPattern.focus();
        JsonsMessageBox($("#textPattern"), "请输入正则表达式");
        return false;
    }
    return true;
}
function buildRegex() {
    var op = "";
    if (document.getElementById("optionGlobal").checked) op = "g";
    if (document.getElementById("optionIgnoreCase").checked) op = op + "i";
    return new RegExp(document.getElementById("textPattern").value, op);
}
function onMatch() {
    if (!isValidFields())
        return false;
    document.getElementById("textMatchResult").value = "";
    var regex = buildRegex();
    var result = document.getElementById("textSour").value.match(regex);
    if (null == result || 0 == result.length) {
        document.getElementById("textMatchResult").value = "（没有匹配）";
        return false;
    }
    if (document.getElementById("optionGlobal").checked) {
var re="";
        var strResult = "共找到 " + result.length + " 处匹配：\r\n";
document.getElementById("textResult").innerText=strResult;
for (var i = 0; i < result.length; ++i){ re += result[i] + "\r\n";}
        document.getElementById("textMatchResult").value = re;
    }
    else {
   document.getElementById("textMatchResult").value = "匹配位置：" + regex.lastIndex + "\r\n匹配结果："+result[0];
    }
    return true;
}
function onReplace() {
    var str = document.getElementById("textSour").value;
    var regex = buildRegex();
    document.getElementById("textReplaceResult").value = str.replace(regex, document.getElementById("textReplace").value);
}
function reset() {
     $("#textSour").value="";
    $("#textPattern").value="";
    $("#textMatchResult").value="";
    $("#textReplace").value="";
    $("#textReplaceResult").value="";
}
$("#regCommon a").click(function () {
    $("#textPattern").val($(this).attr("t"));
    onMatch();
});
function Empty() {
    $("#textSour").value="";
    $("#textMatchResult").value="";
    $("#textReplace").value="";
    $("#textReplaceResult").value="";
    $("#textSour").select();
}


</script>
